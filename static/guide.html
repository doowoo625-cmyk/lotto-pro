<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>로또 예측 시스템 — 배포 & 점검 가이드</title>
  <style>
    :root{--bg:#0f172a;--card:#111827;--text:#e5e7eb;--muted:#9ca3af;--accent:#60a5fa;--ok:#34d399;--warn:#fbbf24;--bad:#f87171;}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI","Noto Sans KR",Arial}
    header{padding:16px;border-bottom:1px solid rgba(255,255,255,.08);background:#0e162e;position:sticky;top:0;z-index:5}
    h1{margin:0;font-size:20px}
    .container{max-width:980px;margin:0 auto;padding:16px}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:14px;padding:16px;margin:12px 0}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);font-size:12px}
    button{background:var(--accent);color:#0b1220;border:none;padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer}
    input[type=text]{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);color:var(--text);border-radius:8px;padding:8px;min-width:260px}
    code,kbd{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);padding:2px 6px;border-radius:6px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
    a{color:#93c5fd}
    .ok{color:var(--ok)} .bad{color:var(--bad)} .muted{color:var(--muted)}
    details{border:1px dashed rgba(255,255,255,.15);border-radius:10px;padding:10px}
    summary{cursor:pointer;font-weight:700}
    ol.check>li{margin:6px 0;padding-left:6px}
    .grid{display:grid;gap:12px}
    @media(min-width:900px){.grid-2{grid-template-columns:1fr 1fr}}
    .mini{font-size:12px}
    .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
  </style>
</head>
<body>
  <header>
    <div class="container row">
      <h1>🛠 로또 예측 시스템 — 배포 & 자동 최신화 점검 가이드</h1>
      <span class="pill">이 페이지를 <b>static/guide.html</b> 로 배치</span>
    </div>
  </header>

  <div class="container">

    <section class="card">
      <h2>1) 배포 전 체크</h2>
      <ol class="check">
        <li><b>리포지토리 구조</b> 확인: <code>server.py</code>, <code>requirements.txt</code>, <code>static/index.html</code>, <code>utils/</code></li>
        <li><b>Render</b> 시작 명령: <code>uvicorn server:app --host 0.0.0.0 --port 8000</code></li>
        <li><b>requirements.txt</b> 설치 가능 확인: <code>fastapi, uvicorn, requests, beautifulsoup4, pandas, numpy</code></li>
      </ol>
      <div class="muted mini">Vercel 사용 시 <code>vercel.json</code> 설정 필요 (서버형 배포 권장: Render)</div>
    </section>

    <section class="card">
      <h2>2) 기본 동작 점검</h2>
      <div class="row">
        <label>배포 URL 입력: <input type="text" id="base" placeholder="예: https://lotto.example.onrender.com"></label>
        <button id="btnPing">API 헬스 체크</button>
        <span id="pingResult" class="pill">대기 중</span>
      </div>
      <div id="results" class="grid grid-2" style="margin-top:12px">
        <div class="card">
          <b>API: /api/latest</b>
          <div class="mini muted">최신 회차 번호</div>
          <pre id="rLatest" class="mono"></pre>
        </div>
        <div class="card">
          <b>API: /api/all?start=1&end=10</b>
          <div class="mini muted">샘플 데이터 1~10회</div>
          <pre id="rAll" class="mono"></pre>
        </div>
      </div>
      <details style="margin-top:8px">
        <summary>문제 해결 가이드</summary>
        <ul>
          <li><b>/api/latest 404</b> → <code>server.py</code> 라우트 확인</li>
          <li><b>배포 URL 접속 안 됨</b> → Render 로그에서 포트/빌드 명령 확인</li>
          <li><b>데이터 비어있음</b> → 동행복권 API 호출 제한, 잠시 후 재시도</li>
        </ul>
      </details>
    </section>

    <section class="card">
      <h2>3) 화면 요소 점검</h2>
      <ol class="check">
        <li><b>예측 번호</b> — 5세트 번호와 보너스 공, 근거(%) 표가 표시되는가?</li>
        <li><b>이번 주 추천 전략 카드</b> — 전략명/Score/보상-위험/승률이 표시되는가?</li>
        <li><b>최근 결과·회차 점프</b> — 최근 10회 표와 회차 검색이 작동하는가?</li>
        <li><b>구간별 번호 빈도</b> — 상위 두 구간(🟩🟦)과 최하위(🟥) 강조가 있는가?</li>
        <li><b>전략별 추천(상세)</b> — 세 전략 표와 승률 도넛 차트가 보이는가?</li>
      </ol>
    </section>

    <section class="card">
      <h2>4) 운영 팁</h2>
      <ul>
        <li><b>캐시 무시 새로고침</b>: <kbd>Ctrl</kbd> + <kbd>F5</kbd></li>
        <li><b>로그 확인</b>: Render 대시보드 → Logs</li>
        <li><b>속도 최적화</b>: 기본 화면은 최근 10회만 렌더링, <em>전체 데이터는 백그라운드 로딩</em></li>
      </ul>
    </section>

    <section class="card">
      <h2>5) 빠른 링크</h2>
      <ul>
        <li><a id="linkHome" href="#" target="_blank">홈 (/) 열기</a></li>
        <li><a id="linkStatic" href="#" target="_blank">정적 페이지 (static/index.html)</a></li>
        <li><a id="linkLatest" href="#" target="_blank">API 최신 회차 (/api/latest)</a></li>
        <li><a id="linkAll" href="#" target="_blank">API 전체 (/api/all)</a></li>
      </ul>
      <div class="muted mini">※ 위 링크는 상단에 입력한 배포 URL 기준으로 자동 설정됩니다.</div>
    </section>

    <section class="card">
      <h2>부록) Render 설정 추천</h2>
      <pre class="mono">Build Command: pip install -r requirements.txt
Start Command: uvicorn server:app --host 0.0.0.0 --port 8000</pre>
      <div class="muted mini">Python 환경은 기본 인식. 필요 시 Python 버전을 Render의 환경 변수로 지정.</div>
    </section>

  </div>

  <script>
    const $ = (id)=>document.getElementById(id);
    function setLinks(base){
      if(!base) return;
      $("#linkHome").href = base + "/";
      $("#linkStatic").href = base + "/static/index.html";
      $("#linkLatest").href = base + "/api/latest";
      $("#linkAll").href = base + "/api/all?start=1&end=10";
    }
    async function ping(){
      const base = $("#base").value.trim().replace(/\/+$/,'');
      if(!base){ alert("배포 URL을 입력하세요"); return; }
      setLinks(base);
      $("#pingResult").textContent = "요청 중...";
      try{
        const [a,b] = await Promise.all([
          fetch(base + "/api/latest", {cache:"no-store"}),
          fetch(base + "/api/all?start=1&end=10", {cache:"no-store"})
        ]);
        const ja = await a.json();
        const jb = await b.json();
        $("#rLatest").textContent = JSON.stringify(ja,null,2);
        $("#rAll").textContent = JSON.stringify({rows: (jb.rows||[]).slice(0,2)}, null, 2) + "\n...";
        $("#pingResult").textContent = "정상";
        $("#pingResult").className = "pill ok";
      }catch(e){
        $("#pingResult").textContent = "실패";
        $("#pingResult").className = "pill bad";
        $("#rLatest").textContent = String(e);
        $("#rAll").textContent = "";
      }
    }
    $("#btnPing").addEventListener("click", ping);
  </script>
</body>
</html>
