<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>로또 예측 시스템 v2.1-fix</title>
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,'Apple SD Gothic Neo','Noto Sans KR',sans-serif;background:#0f172a;color:#e2e8f0;margin:0}
    .container{max-width:980px;margin:0 auto;padding:24px}
    h1{margin:0 0 10px} .muted{color:#94a3b8}
    section{background:#111827;border:1px solid #1f2937;border-radius:16px;padding:16px;margin:16px 0}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{border-bottom:1px solid #1f2937;padding:8px;text-align:center}
    th{color:#a5b4fc}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    input,button{padding:8px 10px;border-radius:10px;border:1px solid #374151;background:#0b1220;color:#e5e7eb}
    button{cursor:pointer}
    .ball{display:inline-flex;width:32px;height:32px;border-radius:50%;align-items:center;justify-content:center;margin:2px;border:2px solid rgba(0,0,0,.25);font-weight:700}
    .yellow{background:#fedd00;color:#1a202c}.blue{background:#2b6cb0}.red{background:#e53e3e}.gray{background:#4a5568}.green{background:#2f855a}
  </style>
</head>
<body>
<div class="container">
  <h1>로또 예측 시스템 <small class="muted">v2.1-fix</small></h1>
  <p class="muted">/api/analysis 정상 작동 · Render & 로컬 실행 지원 · requirements 포함</p>

  <section>
    <div class="row">
      <label>최근 N회 <input id="last" type="number" value="10" min="1" max="100"/></label>
      <button id="run">분석 실행</button>
      <a href="./sample_results.csv" download class="muted">샘플 CSV 다운로드</a>
    </div>
    <pre id="status" class="muted"></pre>
    <div id="recent"></div>
  </section>
</div>
<script>
function ballClass(n){
  if(n<=10)return'yellow'; if(n<=20)return'blue'; if(n<=30)return'red'; if(n<=40)return'gray'; return'green';
}
function ball(n){ return `<span class="ball ${ballClass(n)}">${n}</span>`; }
document.getElementById('run').addEventListener('click', async ()=>{
  const last = +document.getElementById('last').value || 10;
  const status = document.getElementById('status');
  status.textContent = '불러오는 중...';
  try{
    const res = await fetch(`/api/analysis?last=${last}`);
    const data = await res.json();
    status.textContent = `표본 회차: ${data.sample_rounds} · 총 공: ${data.total_balls}`;

    const rows = data.recent.map(d=>{
      const nums = [d.번호1,d.번호2,d.번호3,d.번호4,d.번호5,d.번호6].sort((a,b)=>a-b);
      return `<tr>
        <td>${d.회차}</td><td>${d.날짜}</td>
        <td>${nums.map(ball).join('')}</td>
        <td>${d.sum}</td><td>${d.odd}</td><td>${d.high}</td>
      </tr>`;
    }).join('');

    document.getElementById('recent').innerHTML = `
      <table>
        <thead><tr><th>회차</th><th>날짜</th><th>번호</th><th>합</th><th>홀</th><th>고번호(≥23)</th></tr></thead>
        <tbody>${rows}</tbody>
      </table>`;
  }catch(e){
    status.textContent = '에러: '+e.message;
  }
});
</script>
</body>
</html>
